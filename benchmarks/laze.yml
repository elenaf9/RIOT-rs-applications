modules:
  - name: patch
    selects:
      - executor-thread
    help: patch used repo revision
    env: 
      global:
        UPSTREAM_REPO: https://github.com/future-proof-iot/RIOT-rs.git
        FORKED_REPO: https://github.com/elenaf9/RIOT-rs.git
        CARGO_ARGS:
          - --config 'patch."${UPSTREAM_REPO}".riot-rs.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs.rev="${RIOT_RS_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-runqueue.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-runqueue.rev="${RIOT_RS_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-boards.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-boards.rev="${RIOT_RS_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-rt.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-rt.rev="${RIOT_RS_REV}"'
  - name: main
    selects:
      - patch
    conflicts:
      - multicore-v1
      - multicore-v2
    env:
      global:
        RIOT_RS_REV: bb25312c53b25660c71dc53e1bea65590a713bc6
        FEATURES:
          - single-core

  - name: multicore-v1
    selects:
      - patch
    conflicts:
      - main
      - multicore-v2
    env:
      global:
        RIOT_RS_REV: d1508d740d75ec9429ba5fc8d6009af659f190d4
        FEATURES:
          - multicore
          - multicore-v1

  - name: multicore-v2
    selects:
      - patch
      - ?multicore
    conflicts:
      - main
      - multicore-v1
    env:
      global:
        RIOT_RS_REV: 12d25afbc71c1cc4bb1ef6d87a6493160f738db5
        FEATURES:
          - multicore-v2
    
  - name: single-core
    selects:
      - multicore-v2
    conflicts:
      - multicore
    env:
      global:
        FEATURES:
          - single-core
          - riot-rs/single-core

  - name: multicore
    selects:
      - multicore-v2
    conflicts:
      - single-core
    env:
      global:
        FEATURES:
          - multicore
          - riot-rs/multicore

  - name: affinity
    conflicts:
      - main
      - single-core
      - multicore-v1
    env:
      global:
        FEATURES:
          - affinity
          - riot-rs/core-affinity
  
subdirs:
  - bench_async
  - bench_busy_poll
  - bench_counter
  - bench_critical_section
  - bench_fib
  - bench_leibnitz_pi
  - bench_matrix_mult
  - bench_sched
  - bench_sched_yield
  - bench_thread_flags
  - bench_threads_access
  - runqueue
