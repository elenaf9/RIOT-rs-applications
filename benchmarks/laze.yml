modules:
  - name: patch
    selects:
      - sw/threading
      - sw/benchmark
      - executor-thread
      - ?release
    help: patch used repo revision
    env: 
      global:
        UPSTREAM_REPO: https://github.com/future-proof-iot/RIOT-rs.git
        FORKED_REPO: https://github.com/elenaf9/RIOT-rs.git
        CARGO_ARGS:
          - --config 'patch."${UPSTREAM_REPO}".riot-rs.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs.rev="${RIOT_RS_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-embassy.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-embassy.rev="${RIOT_RS_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-runqueue.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-runqueue.rev="${RIOT_RS_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-boards.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".riot-rs-boards.rev="${RIOT_RS_REV}"'
  - name: main
    selects:
      - patch
    provides_unique:
      - rev
    conflicts:
      - single-core
      - multi-core
    env:
      global:
        RIOT_RS_REV: 64a169e5d7519a7e35e7eb84a22935307f3d9699

  - name: multicore-v1
    selects:
      - patch
    provides_unique:
      - rev
    env:
      global:
        RIOT_RS_REV: 6408e1a239206dea663cae2c32176693a01f9ebe
        FEATURES:
          - multicore-v1
        # CARGO_ARGS:
        #   - --config 'patch.crates-io.embassy-rp.git="https://github.com/elenaf9/embassy"'
        #   - --config 'patch.crates-io.embassy-rp.branch="for-riot-rs-multicore-20240910"'

  - name: multicore-v2
    selects:
      - patch
    provides_unique:
      - rev
    env:
      global:
        RIOT_RS_REV: f3a950732873be87490544e9b976ce279f2b9abe
        FEATURES:
          - multicore-v2

  - name: multicore-v2-cs
    selects:
      - patch
    provides_unique:
      - rev
    env:
      global:
        RIOT_RS_REV: 440ceace4363f02adf6419bd9c0b48e146502095
        FEATURES:
          - multicore-v2

  - name: multicore-v2-locking
    selects:
      - patch
    provides_unique:
      - rev
    env:
      global:
        RIOT_RS_REV: bfdadbdd82c6c7e7e22eff62ab93bf7a8a0ab757
        FEATURES:
          - multicore-v2

  # - name: multicore-v2-locking-rw
  #   selects:
  #     - patch
  #   provides_unique:
  #     - rev
  #   env:
  #     global:
  #       RIOT_RS_REV: 57eebfde435a472b9f122355849a8e1aefd3678c
  #       FEATURES:
  #         - multicore-v2
    
  - name: dual-core
    selects:
      - multi-core
    conflicts:
      - single-core
    context:
      - rp2040
      - esp32s3
    env:
      global:
        FEATURES:
          - dual-core
          - bench-multicore/multicore

  - name: affinity
    conflicts:
      - main
      - single-core
      - multicore-v1
    env:
      global:
        FEATURES:
          - affinity
          - riot-rs/core-affinity
  
subdirs:
  - bench_async
  - bench_busy_poll
  - bench_counter
  - bench_critical_section
  - bench_fib
  - bench_leibnitz_pi
  - bench_matrix_mult
  - bench_sched
  - bench_sched_yield_t
  - bench_spinlocks
  - bench_thread_flags
  - bench_threads_access
  - runqueue
