modules:
  - name: benchmark-default
    selects:
      - sw/threading
      - sw/benchmark
      - executor-thread
      - ?release
      - opt_speed
  - name: patch
    help: patch used repo revision
    env: 
      global:
        UPSTREAM_REPO: https://github.com/ariel-os/ariel-os
        CARGO_ARGS:
          - --config 'patch."${UPSTREAM_REPO}".ariel-os.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os.rev="${DEP_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-embassy.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-embassy.rev="${DEP_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-runqueue.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-runqueue.rev="${DEP_REV}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-boards.git="${FORKED_REPO}"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-boards.rev="${DEP_REV}"'

  - name: probe-rs-baseline
    help: use probe-rs as runner
    conflicts:
      - probe-rs
      - semihosting
    selects:
      - ?debug-console
    env:
      global:
        CARGO_RUNNER: "'probe-rs run ${PROBE_RS_PROTOCOL} --chip ${PROBE_RS_CHIP}'"

  - name: baseline
    selects:
      - patch
      - benchmark-default
      - probe-rs-baseline
    provides_unique:
      - rev
    conflicts:
      - single-core
      - multi-core
    env:
      global:
        FORKED_REPO: https://github.com/future-proof-iot/RIOT-rust.git
        DEP_REV: 88bb5fb37c356c9157d028397f51a3b1ab42f48a
        CARGO_ARGS:
          - --config 'patch."${UPSTREAM_REPO}".ariel-os.package="riot-rs"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-embassy.package="riot-rs-embassy"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-runqueue.package="riot-rs-runqueue"'
          - --config 'patch."${UPSTREAM_REPO}".ariel-os-boards.package="riot-rs-boards"'
  - name: ariel-reallocation
    selects:
      - patch
      - benchmark-default
      - probe-rs-baseline
    provides_unique:
      - rev
    env:
      global:
        FORKED_REPO: https://github.com/elenaf9/RIOT-rs
        DEP_REV: 4133aac705ef2e98142de4d51bbd8efc7c4dd4a2
        FEATURES:
          - multicore-v1

  - name: ariel
    selects:
      - benchmark-default
    provides_unique:
      - rev
    env:
      global:
        FEATURES:
          - multicore-v2
    
  - name: dual-core
    conflicts:
      - single-core
    env:
      global:
        FEATURES:
          - dual-core
          - bench-multicore/multicore
          - ariel-os/multi-core

  - name: affinity
    conflicts:
      - main
      - single-core
      - multicore-v1
    env:
      global:
        FEATURES:
          - affinity
          - ariel-os/core-affinity
  
subdirs:
  - bench_async
  - bench_busy_poll
  - bench_critical_section
  - bench_fib
  - bench_leibnitz_pi
  - bench_lock
  - bench_matrix_mult
  - bench_sched_yield_t
  - bench_thread_flags
  - bench_thread_flags_preempt
  - bench_threads_access
  - runqueue
